<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.kh.admin.main.model.mapper.AdminMapper">
	
	 <select id="login">
		SELECT MEMBER_NO, MEMBER_EMAIL, MEMBER_NICKNAME, MEMBER_PW, AUTHORITY
		FROM "MEMBER"
		WHERE MEMBER_EMAIL = #{memberEmail}
		AND MEMBER_DEL_FL ='N'
		AND AUTHORITY = 2
	 </select>
	 
	 <!-- 탈퇴 회원 조회 -->
	 <select id="selectWithdrawnMemberList">
	 	SELECT MEMBER_NO, MEMBER_EMAIL, MEMBER_NICKNAME
	 	FROM "MEMBER"
	 	WHERE MEMBER_DEL_FL = 'Y'
	 	ORDER BY MEMBER_NO DESC
	 </select>
	 
	 <!-- 탈퇴 회원 복구 -->
	 <update id="restoreMember">
	 	UPDATE "MEMBER" SET
	 	MEMBER_DEL_FL = 'N'
	 	WHERE MEMBER_NO = #{memberNo}
	 	AND MEMBER_DEL_FL = 'Y'
	 </update>
	 
	 <select id="selectdeleteBoardList">
	 	SELECT BOARD_NO ,BOARD_TITLE , MEMBER_NICKNAME 
		FROM BOARD
		JOIN "MEMBER" USING(MEMBER_NO)
		WHERE BOARD_DEL_FL = 'Y'
	 </select>
	 
	 <update id="restoreBoard">
	 	UPDATE "BOARD" SET
	 	BOARD_DEL_FL = 'N'
	 	WHERE BOARD_NO = #{boardNo}
	 	AND BOARD_DEL_FL = 'Y'
	 </update>
	 
	 <!-- 새로 가입한 회원 조회 (7일이내) -->
	 <select id="getNewMember">
	 	SELECT MEMBER_NO,MEMBER_EMAIL,MEMBER_NICKNAME,ENROLL_DATE
		FROM "MEMBER"
		WHERE ENROLL_DATE >= SYSDATE -1 
		AND AUTHORITY = 1
		ORDER BY ENROLL_DATE DESC
	 </select>
	 
	 <!--  최대 조회수 게시글 조회
	 	만약 최대 조회수가 똑같은 게시물이 여러개 존재한다면
	 	가장 최근에 작성된 게시글 기준(BOARD_NO가 큰 순서)으로 정렬해서 조회
	  -->
	 <select id="maxReadCount">
	 	SELECT BOARD_NAME, BOARD_NO, BOARD_TITLE, MEMBER_NICKNAME, READ_COUNT
		FROM "BOARD"
		JOIN "MEMBER" USING(MEMBER_NO)
		JOIN "BOARD_TYPE" USING(BOARD_CODE)
		WHERE READ_COUNT = (SELECT MAX(READ_COUNT) FROM "BOARD")
		ORDER BY BOARD_NO DESC
		FETCH FIRST 1 ROWS ONLY
	 </select>
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
</mapper>
